

@startuml

participant "Frontend" as Frontend 
participant "PaychecksController" as PaychecksController
participant "Paycheck" as Paycheck
participant "IDAS<Job>" as Job
participant "IDAS<WorkShift>" as WorkShift
participant "IDAS<SupplementDetails>" as SupplementDetails
participant "<<Database>>" as Database



Frontend -> PaychecksController: GET /paychecks\n{companyName, month}
PaychecksController -> PaychecksController: Validate request body
opt Invalid request body
PaychecksController -> Frontend: 400 bad request 
end

PaychecksController -> Job: GetByIdAsync(jobId,UserId)
Job -> Database: get job
Database --> Job: result: job or null

Job --> PaychecksController: result: job or null

opt job not found
PaychecksController -> Frontend: 404 not found
end

PaychecksController -> PaychecksController: CalculateSalaryBeforeTaxAndTotalHours(timeperiod,job)

PaychecksController -> SupplementDetails: GetFilteredAsync(job)
SupplementDetails -> Database: get supplement details
Database --> SupplementDetails: result: supplement details or null
SupplementDetails --> PaychecksController: result: supplement details or null
PaychecksController -> WorkShift: GetFilteredAsync(timeperiod)
WorkShift -> Database: get workshifts
Database --> WorkShift: result: workshifts or null
PaychecksController <-- WorkShift: result: workshifts or null

opt no workshifts found
PaychecksController -> Frontend: 404 not found

end
loop for each workshift in workshifts
PaychecksController -> PaychecksController: totalWorkedHours += workshift.EndTime - workshift.StartTime

PaychecksController -> PaychecksController: totalSupplementPay += CalculateSupplementPay(workshift, SupplementDetails)
end

PaychecksController -> Paycheck: new Paycheck()
Paycheck --> PaychecksController: Paycheck object
PaychecksController -> Frontend: 200 OK, Paycheck


@enduml